/*!
 *  CliqueUI - v1.0.4 - 2015-10-14
 *  http://ui.cliquestudios.com
 *  Copyright (c) 2015 Clique Studios;
 */

!function(a){if("function"==typeof define&&define.amd&&define("clique-lightbox",["clique"],function(){return a(Clique)}),!window.Clique)throw new Error("Clique.lightbox requires Clique.core");window.Clique&&a(Clique)}(function(a){var b,c,d,e;return b=a.$,e=null,c={},a.component("lightbox",{defaults:{group:!1,duration:400,keyboard:!0},index:0,items:!1,boot:function(){return a.$html.on("click","[data-lightbox]",function(b){var c;return b.preventDefault(),c=a.$(this),c.data("clique.data.lightbox")||a.lightbox(c,a.utils.options(c.attr("data-lightbox"))),c.data("clique.data.lightbox").show(c)}),a.$doc.on("keyup",function(a){if(e&&e.is(":visible")&&e.lightbox.options.keyboard)switch(a.preventDefault(),a.keyCode){case 37:return e.lightbox.previous();case 39:return e.lightbox.next()}})},init:function(){var b,c,d;return b=this,d=[],this.index=0,this.siblings=[],this.element&&this.element.length?(c=this.options.group?a.$(['[data-lightbox*="'+this.options.group+'"]',"[data-lightbox*='"+this.options.group+"']"].join(",")):this.element,c.each(function(){var b;return b=a.$(this),d.push({source:b.attr("href"),title:b.attr("title"),type:b.attr("data-lightbox-type")||"auto",link:b})}),this.index=c.index(this.element),this.siblings=d):this.options.group&&this.options.group.length&&(this.siblings=this.options.group),this.trigger("lightbox-init",[this])},show:function(b){var c,e,f,g;return this.modal=d(this),this.modal.dialog.stop(),this.modal.content.stop(),c=this,g=a.$.Deferred(),e=null,f=null,b=b||0,"object"==typeof b&&this.siblings.forEach(function(a,c){b[0]===a.link[0]&&(b=c)}),0>b?b=this.siblings.length-b:this.siblings[b]||(b=0),f=this.siblings[b],e={lightbox:c,source:f.source,type:f.type,index:b,promise:g,title:f.title,item:f,meta:{content:"",width:null,height:null}},this.index=b,this.modal.content.empty(),this.modal.is(":visible")||(this.modal.content.css({width:"",height:""}).empty(),this.modal.modal.show()),this.modal.loader.removeClass("hidden"),g.promise().done(function(){return c.data=e,c.fitSize(e)}).fail(function(){return alert("Loading resource failed!")}),c.trigger("showitem.clique.lightbox",[e])},fitSize:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;return b=this,d=this.data,m=this.modal.dialog.outerWidth()-this.modal.dialog.width(),h=parseInt(this.modal.dialog.css("margin-top"),10),g=parseInt(this.modal.dialog.css("margin-bottom"),10),f=h+g,c=d.meta.content,i=b.options.duration,this.siblings.length>1&&(c=[c,'<a href="#" class="slidenav slidenav-contrast slidenav-previous hidden-touch" data-lightbox-previous></a>','<a href="#" class="slidenav slidenav-contrast slidenav-next hidden-touch" data-lightbox-next></a>'].join("")),o=a.$("<div>&nbsp;</div>").css({opacity:0,position:"absolute",top:0,left:0,width:"100%","max-width":b.modal.dialog.css("max-width"),padding:b.modal.dialog.css("padding"),margin:b.modal.dialog.css("margin")}),l=null,k=null,p=d.meta.width,j=d.meta.height,o.appendTo("body").width(),l=o.width(),k=window.innerHeight-f,o.remove(),this.modal.dialog.find(".modal-caption").remove(),d.title&&(this.modal.dialog.append('<div class="modal-caption">'+d.title+"</div>"),k-=this.modal.dialog.find(".modal-caption").outerHeight()),l<d.meta.width&&(j=Math.floor(j*(l/p)),p=l),j>k&&(j=Math.floor(k),p=Math.ceil(d.meta.width*(k/d.meta.height))),this.modal.content.css("opacity",0).width(p).html(c),"iframe"===d.type&&this.modal.content.find("iframe:first").height(j),e=j+m,n=Math.floor(window.innerHeight/2-e/2)-f,0>n&&(n=0),this.modal.closer.addClass("hidden"),b.modal.data("mwidth")===p&&b.modal.data("mheight")===j&&(i=0),this.modal.dialog.animate({width:p+m,height:j+m,top:n},i,"swing",function(){return b.modal.loader.addClass("hidden"),b.modal.content.css({width:""}).animate({opacity:1},function(){return b.modal.closer.removeClass("hidden")}),b.modal.data({mwidth:p,mheight:j})})},next:function(){return this.show(this.siblings[this.index+1]?this.index+1:0)},previous:function(){return this.show(this.siblings[this.index-1]?this.index-1:this.siblings.length-1)}}),a.plugin("lightbox","image",{init:function(a){return a.on("showitem.clique.lightbox",function(a,b){var d,e;if("image"===b.type||b.source&&b.source.match(/\.(jpg|jpeg|png|gif|svg)$/)){if(e=function(a,c,d){return b.meta={content:'<img class="responsive-width" width="'+c+'" height="'+d+'" src ="'+a+'">',width:c,height:d},b.type="image",b.promise.resolve()},c[b.source])return e(b.source,c[b.source].width,c[b.source].height);d=new Image,d.onerror=function(){return b.promise.reject("Loading image failed")},d.onload=function(){return c[b.source]={width:d.width,height:d.height},e(b.source,c[b.source].width,c[b.source].height)},d.src=b.source}})}}),a.plugin("lightbox","youtube",{init:function(a){var b,d;return b=/(\/\/.*?youtube\.[a-z]+)\/watch\?v=([^&]+)&?(.*)/,d=/youtu\.be\/(.*)/,a.on("showitem.clique.lightbox",function(a,d){var e,f,g,h;return e=null,g=null,h=function(a,b,c){return d.meta={content:'<iframe src="//www.youtube.com/embed/'+a+'" width="'+b+'" height="'+c+'" style="max-width:100%;"></iframe>',width:b,height:c},d.type="iframe",d.promise.resolve()},g=d.source.match(b),g&&(e=g[2]),g&&(e=g[1]),e?(c[e]?h(e,c[e].width,c[e].height):(f=new Image,f.onerror=function(){return c[e]={width:640,height:320},h(e,c[e].width,c[e].height)},f.onload=function(){return c[e]={width:f.width,height:f.height},h(e,f.width,f.height)},f.src="//img.youtube.com/vi/"+e+"/0.jpg"),a.stopImmediatePropagation()):void 0})}}),a.plugin("lightbox","vimeo",{init:function(b){var d,e;return e=/(\/\/.*?)vimeo\.[a-z]+\/([0-9]+).*?/,d=null,b.on("showitem.clique.lightbox",function(b,f){var g,h;return g=null,h=function(a,b,c){return f.meta={content:'<iframe src="//player.vimeo.com/video/'+a+'" width="'+b+'" height="'+c+'" style="width:100%;box-sizing:border-box;"></iframe>',width:b,height:c},f.type="iframe",f.promise.resolve()},d=f.source.match(e),d?(g=d[2],c[g]?h(g,c[g].width,c[g].height):a.$.ajax({type:"GET",url:"http://vimeo.com/api/oembed.json?url="+encodeURI(f.source),jsonp:"callback",dataType:"jsonp",success:function(a){return c[g]={width:a.width,height:a.height},h(g,c[g].width,c[g].height)}}),b.stopImmediatePropagation()):void 0})}}),a.plugin("lightbox","video",{init:function(b){return b.on("showitem.clique.lightbox",function(b,d){var e,f,g;if(f=function(a,b,c){return d.meta={content:'<video class="responsive-width" src="'+a+'" width="'+b+'" height="'+c+'" controls></video>',width:b,height:c},d.type="video",d.promise.resolve()},"video"===d.type||d.source.match(/\.(mp4|webm|ogv)$/)){if(c[d.source])return f(d.source,c[d.source].width,c[d.source].height);g=a.$('<video style="position:fixed;visibility:hidden;top:-10000px;"></video>').attr("src",d.source).appendTo("body"),e=setInterval(function(){return g[0].videoWidth?(clearInterval(e),c[d.source]={width:g[0].videoWidth,height:g[0].videoHeight},f(d.source,c[d.source].width,c[d.source].height),g.remove()):void 0},20)}})}}),d=function(b){return e?(e.lightbox=b,e):(e=a.$(['<div class="modal">','<div class="modal-dialog modal-dialog-lightbox slidenav-position" style="margin-left:auto;margin-right:auto;width:200px;height:200px;top:'+Math.abs(window.innerHeight/2-200)+'px;">','<a href="#" class="modal-close close close-alt"></a>','<div class="lightbox-content"></div>','<div class="modal-spinner hidden"></div>',"</div>","</div>"].join("")).appendTo("body"),e.dialog=e.find(".modal-dialog:first"),e.content=e.find(".lightbox-content:first"),e.loader=e.find(".modal-spinner:first"),e.closer=e.find(".close.close-alt"),e.modal=a.modal(e),e.on("swipeRight swipeLeft",function(a){return e.lightbox["swipeLeft"===a.type?"next":"previous"]()}).on("click","[data-lightbox-previous], [data-lightbox-next]",function(b){return b.preventDefault(),e.lightbox[a.$(this).is("[data-lightbox-next]")?"next":"previous"]()}),e.on("hide.clique.modal",function(a){return e.content.html("")}),a.$win.on("load resize orientationchange",a.utils.debounce(function(a){return function(){return e.is(":visible")?e.lightbox.fitSize():void 0}}(this),100)),e.lightbox=b,e)},a.lightbox.create=function(b,c){var d,e;if(b)return d=[],e=null,b.forEach(function(b){return d.push(a.$.extend({source:"",title:"",type:"auto",link:!1},"string"==typeof b?{source:b}:b))}),e=a.lightbox(a.$.extend({},c,{group:d}))},a.lightbox});