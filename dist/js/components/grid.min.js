/*!
 *  CliqueUI - v1.0.4 - 2015-10-14
 *  http://ui.cliquestudios.com
 *  Copyright (c) 2015 Clique Studios;
 */

!function(a){if("function"==typeof define&&define.amd&&define("clique-grid",["clique"],function(){return a(Clique)}),!window.Clique)throw new Error("Clique.grid requires Clique.core");window.Clique&&a(Clique)}(function(a){function b(a){return c(a)}a.component("grid",{defaults:{colwidth:"auto",animation:!0,duration:300,gutter:0,controls:!1,filter:!1},boot:function(){a.ready(function(b){a.$("[data-grid]",b).each(function(){var b=a.$(this);if(!b.data("clique.data.grid")){a.grid(b,a.utils.options(b.attr("data-grid")))}})})},init:function(){var b=this,c=String(this.options.gutter).trim().split(" ");this.gutterv=parseInt(c[0],10),this.gutterh=parseInt(c[1]||c[0],10),this.element.css({position:"relative"}),this.controls=null,this.options.controls&&(this.controls=a.$(this.options.controls),this.controls.on("click","[data-filter]",function(c){c.preventDefault(),b.filter(a.$(this).data("filter"))}),this.controls.on("click","[data-sort]",function(c){c.preventDefault();var d=a.$(this).attr("data-sort").split(":");b.sort(d[0],d[1])})),a.$win.on("load resize orientationchange",a.utils.debounce(function(){b.currentfilter?b.filter(b.currentfilter):this.updateLayout()}.bind(this),100)),this.on("display.clique.check",function(){b.element.is(":visible")&&b.updateLayout()}),a.$html.on("changed.clique.dom",function(a){b.updateLayout()}),this.options.filter!==!1?this.filter(this.options.filter):this.updateLayout()},_prepareElements:function(){var a,b=this.element.children(":not([data-grid-prepared])");b.length&&(a={position:"absolute","box-sizing":"border-box",width:"auto"===this.options.colwidth?"":this.options.colwidth},this.options.gutter&&(a["padding-left"]=this.gutterh,a["padding-bottom"]=this.gutterv,this.element.css("margin-left",-1*this.gutterh)),b.attr("data-grid-prepared","true").css(a))},updateLayout:function(c){this._prepareElements(),c=c||this.element.children(":visible");var d,e,f,g,h,i,j,k,l=c,m=this.element.width()+2*this.gutterh+2,n=0,o=0,p=[];this.trigger("beforeupdate.clique.grid",[l]),l.each(function(c){for(k=b(this),d=a.$(this),e=k.outerWidth,f=k.outerHeight,n=0,o=0,h=0,j=p.length;j>h;h++)g=p[h],n<=g.aX&&(n=g.aX),n+e>m&&(n=0),o<=g.aY&&(o=g.aY);p.push({ele:d,top:o,left:n,width:e,height:f,aY:o+f,aX:n+e})});var q,r=0;for(h=0,j=p.length;j>h;h++){for(g=p[h],o=0,i=0;h>i;i++)q=p[i],g.left<q.aX&&q.left+1<g.aX&&(o=q.aY);g.top=o,g.aY=o+g.height,r=Math.max(r,g.aY)}r-=this.gutterv,this.options.animation?(this.element.stop().animate({height:r},100),p.forEach(function(a){a.ele.stop().animate({top:a.top,left:a.left,opacity:1},this.options.duration)}.bind(this))):(this.element.css("height",r),p.forEach(function(a){a.ele.css({top:a.top,left:a.left,opacity:1})}.bind(this))),setTimeout(function(){a.$doc.trigger("scrolling.clique.document")},2*this.options.duration*(this.options.animation?1:0)),this.trigger("afterupdate.clique.grid",[l])},filter:function(b){this.currentfilter=b,b=b||[],"string"==typeof b&&(b=b.split(/,/).map(function(a){return a.trim()}));var c=this,d=this.element.children(),e={visible:[],hidden:[]};d.each(function(c){var d=a.$(this),f=d.attr("data-filter"),g=b.length?!1:!0;f&&(f=f.split(/,/).map(function(a){return a.trim()}),b.forEach(function(a){f.indexOf(a)>-1&&(g=!0)})),e[g?"visible":"hidden"].push(d)}),e.hidden=a.$(e.hidden).map(function(){return this[0]}),e.visible=a.$(e.visible).map(function(){return this[0]}),e.hidden.attr("aria-hidden","true").filter(":visible").fadeOut(this.options.duration),e.visible.attr("aria-hidden","false").filter(":hidden").css("opacity",0).show(),c.updateLayout(e.visible),this.controls&&this.controls.length&&this.controls.find("[data-filter]").removeClass("active").filter('[data-filter="'+b+'"]').addClass("active")},sort:function(b,c){c=c||1,"string"==typeof c&&(c="desc"===c.toLowerCase()?-1:1);var d=this.element.children();d.sort(function(d,e){return d=a.$(d),e=a.$(e),(e.data(b)||"")<(d.data(b)||"")?c:-1*c}).appendTo(this.element),this.updateLayout(d.filter(":visible")),this.controls&&this.controls.length&&this.controls.find("[data-sort]").removeClass("active").filter('[data-sort="'+b+":"+(-1===c?"desc":"asc")+'"]').addClass("active")}});var c=function(){function a(a){if(a){if("string"==typeof k[a])return a;a=a.charAt(0).toUpperCase()+a.slice(1);for(var b,c=0,d=j.length;d>c;c++)if(b=j[c]+a,"string"==typeof k[b])return b}}function b(a){var b=parseFloat(a),c=-1===a.indexOf("%")&&!isNaN(b);return c&&b}function c(){}function d(){for(var a={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},b=0,c=m.length;c>b;b++){var d=m[b];a[d]=0}return a}function e(){if(!n){n=!0;var c=window.getComputedStyle;if(g=function(){var a=c?function(a){return c(a,null)}:function(a){return a.currentStyle};return function(b){var c=a(b);return c||l("Style returned "+c+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),c}}(),h=a("boxSizing")){var d=document.createElement("div");d.style.width="200px",d.style.padding="1px 2px 3px 4px",d.style.borderStyle="solid",d.style.borderWidth="1px 2px 3px 4px",d.style[h]="border-box";var e=document.body||document.documentElement;e.appendChild(d);var f=g(d);i=200===b(f.width),e.removeChild(d)}}}function f(a){if(e(),"string"==typeof a&&(a=document.querySelector(a)),a&&"object"==typeof a&&a.nodeType){var c=g(a);if("none"===c.display)return d();var f={};f.width=a.offsetWidth,f.height=a.offsetHeight;for(var j=f.isBorderBox=!(!h||!c[h]||"border-box"!==c[h]),k=0,l=m.length;l>k;k++){var n=m[k],o=c[n],p=parseFloat(o);f[n]=isNaN(p)?0:p}var q=f.paddingLeft+f.paddingRight,r=f.paddingTop+f.paddingBottom,s=f.marginLeft+f.marginRight,t=f.marginTop+f.marginBottom,u=f.borderLeftWidth+f.borderRightWidth,v=f.borderTopWidth+f.borderBottomWidth,w=j&&i,x=b(c.width);x!==!1&&(f.width=x+(w?0:q+u));var y=b(c.height);return y!==!1&&(f.height=y+(w?0:r+v)),f.innerWidth=f.width-(q+u),f.innerHeight=f.height-(r+v),f.outerWidth=f.width+s,f.outerHeight=f.height+t,f}}var g,h,i,j="Webkit Moz ms Ms O".split(" "),k=document.documentElement.style,l="undefined"==typeof console?c:function(a){console.error(a)},m=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],n=!1;return f}()});