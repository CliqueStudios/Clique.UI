/*!
 *  CliqueUI - v1.0.4 - 2015-10-14
 *  http://ui.cliquestudios.com
 *  Copyright (c) 2015 Clique Studios;
 */

!function(a){if("function"==typeof define&&define.amd&&define("clique-sortable",["clique"],function(){return a(Clique)}),!window.Clique)throw new Error("Clique.sortable requires Clique.core");window.Clique&&a(Clique)}(function(a){"use strict";function b(a,b){var c=a.parentNode;if(b.parentNode!==c)return!1;for(var d=a.previousSibling;d&&9!==d.nodeType;){if(d===b)return!0;d=d.previousSibling}return!1}function c(a,b){var c=b;if(c===a)return null;for(;c;){if(c.parentNode===a)return c;if(c=c.parentNode,!c||!c.ownerDocument||11===c.nodeType)break}return null}function d(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.returnValue=!1}var e,f,g,h,i,j="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,k=!1;return a.component("sortable",{defaults:{warp:!1,animation:150,threshold:10,childClass:"sortable-item",placeholderClass:"sortable-placeholder",overClass:"sortable-over",draggingClass:"sortable-dragged",dragMovingClass:"sortable-moving",dragCustomClass:"",handleClass:!1,stop:function(){},start:function(){},change:function(){}},boot:function(){a.ready(function(b){a.$("[data-sortable]",b).each(function(){var b=a.$(this);if(!b.data("clique.data.sortable")){a.sortable(b,a.utils.options(b.attr("data-sortable")))}})}),a.$html.on("mousemove touchmove",function(b){if(i){var c=b.originalEvent.targetTouches?b.originalEvent.targetTouches[0]:b;(Math.abs(c.pageX-i.pos.x)>i.threshold||Math.abs(c.pageY-i.pos.y)>i.threshold)&&i.apply()}if(e){f||(f=!0,e.show(),e.$current.addClass(e.$sortable.options.placeholderClass),e.$sortable.element.children().addClass(e.$sortable.options.childClass),a.$html.addClass(e.$sortable.options.dragMovingClass));var d=e.data("mouse-offset"),g=parseInt(b.originalEvent.pageX,10)+d.left,h=parseInt(b.originalEvent.pageY,10)+d.top;e.css({left:g,top:h}),h<a.$win.scrollTop()?a.$win.scrollTop(a.$win.scrollTop()-Math.ceil(e.height()/2)):h+e.height()>window.innerHeight+a.$win.scrollTop()&&a.$win.scrollTop(a.$win.scrollTop()+Math.ceil(e.height()/2))}}),a.$html.on("mouseup touchend",function(){!f&&h&&(location.href=h.attr("href")),i=h=!1})},init:function(){function b(b){return function(d){var e=j&&d.touches&&d.touches[0]||{},f=e.target||d.target;if(j&&document.elementFromPoint&&(f=document.elementFromPoint(d.pageX-document.body.scrollLeft,d.pageY-document.body.scrollTop)),a.$(f).hasClass(n.options.childClass))b.apply(f,[d]);else if(f!==o){var g=c(o,f);g&&b.apply(g,[d])}}}function l(){k||(j?o.addEventListener("touchmove",x,!1):(o.addEventListener("mouseover",t,!1),o.addEventListener("mouseout",u,!1)),o.addEventListener(j?"touchend":"mouseup",v,!1),document.addEventListener(j?"touchend":"mouseup",w,!1),document.addEventListener("selectstart",d,!1))}function m(){k||(j?o.removeEventListener("touchmove",x,!1):(o.removeEventListener("mouseover",t,!1),o.removeEventListener("mouseout",u,!1)),o.removeEventListener(j?"touchend":"mouseup",v,!1),document.removeEventListener(j?"touchend":"mouseup",w,!1),document.removeEventListener("selectstart",d,!1))}var n=this,o=this.element[0],p=null,q=null;Object.keys(this.options).forEach(function(a){-1!==String(n.options[a]).indexOf("Class")&&(n.options[a]=n.options[a])}),k?this.element.children().attr("draggable","true"):this.element.on("mousedown touchstart","a[href]",function(b){b.ctrlKey||b.metaKey||b.shiftKey||(h=a.$(this),b.preventDefault())}).on("click","a[href]",function(b){return b.ctrlKey||b.metaKey||b.shiftKey?void 0:(h=a.$(this),b.stopImmediatePropagation(),!1)});var r=b(function(b){f=!1,g=!1;var c=a.$(b.target);n.element.children();if(j||2!==b.button){if(n.options.handleClass){var d=c.hasClass(n.options.handleClass)?c:c.closest("."+n.options.handleClass,o);if(!d.length)return}if(!c.is(":input")){b.dataTransfer&&(b.dataTransfer.effectAllowed="move",b.dataTransfer.dropEffect="move"),p=this,e&&e.remove();var h=a.$(p),m=h.offset();i={pos:{x:b.pageX,y:b.pageY},threshold:n.options.threshold,apply:function(){e=a.$('<div class="'+[n.options.draggingClass,n.options.dragCustomClass].join(" ")+'"></div>').css({display:"none",top:m.top,left:m.left,width:h.width(),height:h.height(),padding:h.css("padding")}).data("mouse-offset",{left:m.left-parseInt(b.pageX,10),top:m.top-parseInt(b.pageY,10)}).append(h.html()).appendTo("body"),e.$current=h,e.$sortable=n,l(),n.options.start(this,p),n.trigger("start.clique.sortable",[n,p]),i=!1}},k||b.preventDefault()}}}),s=b(function(a){return p?(a.preventDefault&&a.preventDefault(),!1):!0}),t=b(a.utils.debounce(function(b){if(!p||p===this)return!0;var c=n.dragenterData(this);return n.dragenterData(this,c+1),0===c&&(a.$(this).addClass(n.options.overClass),n.options.warp||n.moveElementNextTo(p,this)),!1}),40),u=b(function(b){var c=n.dragenterData(this);n.dragenterData(this,c-1),n.dragenterData(this)||(a.$(this).removeClass(n.options.overClass),n.dragenterData(this,!1))}),v=b(function(b){if("drop"===b.type&&(b.stopPropagation&&b.stopPropagation(),b.preventDefault&&b.preventDefault()),g||n.options.warp){if(n.options.warp){var c=p.nextSibling;this.parentNode.insertBefore(p,this),this.parentNode.insertBefore(this,c),a.utils.checkDisplay(n.element.parent())}n.options.change(this,p),n.trigger("change.clique.sortable",[n,p])}}),w=function(b){p=null,q=null,n.element.children().each(function(){1===this.nodeType&&(a.$(this).removeClass(n.options.overClass).removeClass(n.options.placeholderClass).removeClass(n.options.childClass),n.dragenterData(this,!1))}),a.$("html").removeClass(n.options.dragMovingClass),m(),n.options.stop(this),n.trigger("stop.clique.sortable",[n]),e.remove(),e=null},x=b(function(b){return p&&p!==this&&q!==this?(n.element.children().removeClass(n.options.overClass),q=this,n.options.warp?a.$(this).addClass(n.options.overClass):n.moveElementNextTo(p,this),d(b)):!0});k?(o.addEventListener("dragstart",r,!1),o.addEventListener("dragenter",t,!1),o.addEventListener("dragleave",u,!1),o.addEventListener("drop",v,!1),o.addEventListener("dragover",s,!1),o.addEventListener("dragend",w,!1)):o.addEventListener(j?"touchstart":"mousedown",r,!1)},dragenterData:function(b,c){return b=a.$(b),1===arguments.length?parseInt(b.attr("data-child-dragenter"),10)||0:void(c?b.attr("data-child-dragenter",Math.max(0,c)):b.removeAttr("data-child-dragenter"))},moveElementNextTo:function(c,d){g=!0;var e=this,f=a.$(c).parent().css("min-height",""),h=b(c,d)?d:d.nextSibling,i=f.children(),j=i.length;return e.options.warp||!e.options.animation?(d.parentNode.insertBefore(c,h),void a.utils.checkDisplay(e.element.parent())):(f.css("min-height",f.height()),i.stop().each(function(){var b=a.$(this),c=b.position();c.width=b.width(),b.data("offset-before",c)}),d.parentNode.insertBefore(c,h),a.utils.checkDisplay(e.element.parent()),i=f.children().each(function(){var b=a.$(this);b.data("offset-after",b.position())}).each(function(){var b=a.$(this),c=b.data("offset-before");b.css({position:"absolute",top:c.top,left:c.left,"min-width":c.width})}),void i.each(function(){var b=a.$(this),c=(b.data("offset-before"),b.data("offset-after"));b.css("pointer-events","none").width(),setTimeout(function(){b.animate({top:c.top,left:c.left},e.options.animation,function(){b.css({position:"",top:"",left:"","min-width":"","pointer-events":""}).removeClass(e.options.overClass).attr("data-child-dragenter",""),j--,j||(f.css("min-height",""),a.utils.checkDisplay(e.element.parent()))})},0)}))},serialize:function(){var b,c,d=[];return this.element.children().each(function(e,f){b={};for(var g=0;g<f.attributes.length;g++)c=f.attributes[g],0===c.name.indexOf("data-")&&(b[c.name.substr(5)]=a.utils.str2json(c.value));d.push(b)}),d}}),a.sortable});