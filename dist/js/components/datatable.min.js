/*!
 *  CliqueUI - v1.0.4 - 2015-10-14
 *  http://ui.cliquestudios.com
 *  Copyright (c) 2015 Clique Studios;
 */

!function(a){if("function"==typeof define&&define.amd&&define("clique-datatable",["clique"],function(){return a(Clique)}),!window.Clique)throw new Error("Clique.datatable requires Clique.core");window.Clique&&a(Clique)}(function(a){var b;return b=a.$,a.component("datatableSearch",{defaults:{table:""},boot:function(){return a.ready(function(c){return b("[data-datatable-search]",c).each(function(){var c,d;c=b(this),c.data("clique.data.datatableSearch")||(d=a.datatableSearch(c,a.utils.options(c.attr("data-datatable-search"))))})})},init:function(){var c;return c=a.$(this.options.table),this.element.on("keyup",function(a){var d,e;return e=b(this).val(),d=c.data("clique.data.datatable"),d.searchString(e)})}}),a.component("datatablePrevious",{defaults:{table:""},boot:function(){return a.ready(function(c){return b("[data-datatable-previous]",c).each(function(){var c,d;c=b(this),c.data("clique.data.datatablePrevious")||(d=a.datatablePrevious(c,a.utils.options(c.attr("data-datatable-previous"))))})})},init:function(){return this.table=a.$(this.options.table),this.tableInitHandler(),this.showPageListener(),this.bindClick()},tableInitHandler:function(){var a;return a=this,this.table.on("init.datatable.clique",function(c){a.datatable=b(this).data("clique.data.datatable"),a.datatable.previousButton=b(this.element)})},showPageListener:function(){var a;return a=this,this.table.on("didshowpage.datatable.clique",function(){return a.datatable.disablePrevious?a.element.addClass("disabled"):a.element.removeClass("disabled")})},bindClick:function(){var a;return a=this,this.on("click",function(c){return c.preventDefault(),b(this).hasClass("disabled")||b(this).attr("disabled")?!1:a.table.trigger("previous.datatable.clique")})}}),a.component("datatableNext",{defaults:{table:""},boot:function(){return a.ready(function(c){return b("[data-datatable-next]",c).each(function(){var c,d;c=b(this),c.data("clique.data.datatableNext")||(d=a.datatableNext(c,a.utils.options(c.attr("data-datatable-next"))))})})},init:function(){return this.table=a.$(this.options.table),this.tableInitHandler(),this.showPageListener(),this.bindClick()},tableInitHandler:function(){var a;return a=this,this.table.on("init.datatable.clique",function(){a.datatable=b(this).data("clique.data.datatable"),a.datatable.nextButton=b(this.element)})},showPageListener:function(){var a;return a=this,this.table.on("didshowpage.datatable.clique",function(){return a.datatable.disableNext?a.element.addClass("disabled"):a.element.removeClass("disabled")})},bindClick:function(){var a;return a=this,this.on("click",function(c){return c.preventDefault(),b(this).hasClass("disabled")||b(this).attr("disabled")?!1:a.table.trigger("next.datatable.cliquet")})}}),a.component("datatable",{defaults:{paginationWrapper:".datatable-pagination",perPage:10,infoWrapper:".datatable-info",infoString:"Showing rows #{start} through #{end} of #{total}",sortColumn:0,sortOrder:"asc"},currentPage:0,columns:[],elements:{},boot:function(){a.ready(function(c){b("[data-datatable]",c).each(function(){var c,d;c=b(this),c.data("clique.data.datatable")||(d=a.datatable(c,a.utils.options(c.attr("data-datatable"))))})})},init:function(){return this.setProperties(),this.bindListeners(),this.bindEvents(),this.addObserver(),this.observerIsTriggered||this.observerCallback(),setTimeout(function(a){return function(){return a.trigger("init.datatable.clique",[a.options])}}(this),0)},findElement:function(a,c){var d,e;return"#"===c[0]?b(c):(e=a.parents(),d=null,e.each(function(){return b(this).find(c).length?(d=b(this).find(c),!1):void 0}),d)},setProperties:function(){return this.elements.tbody=this.find("> tbody"),this.elements.thead=this.find("> thead"),this.elements.th=this.elements.thead.find("> tr > th"),this.options.paginationWrapper&&(this.elements.pagination=this.findElement(this.element,this.options.paginationWrapper)),this.options.infoWrapper&&(this.elements.infoWrapper=this.findElement(this.element,this.options.infoWrapper)),this.setColumns()},setColumns:function(){var a;a=[],this.elements.th.each(function(c){var d,e,f;return e=b(this),d=e.html(),f=b("<div></div>"),f.append(d),f.children().each(function(){return b(this).remove()}),b(this).width(b(this).outerWidth()),a.push({index:c,title:f.text().trim(),width:b(this).outerWidth()})}),this.columns=a},setDataProperties:function(a){this.data=a,!this.originalData&&this.data.length&&(this.originalData=this.data),this.dataLength=this.data.length,this.options.paginationWrapper||(this.options.perPage=this.dataLength),this.pages=Math.ceil(this.dataLength/this.options.perPage)-1},buildPagination:function(){var a,c,d,e,f,g;if(g=this.options.paginationWrapper,a=this,this.pagination&&this.pagination.length||(f=this.element.parents(),f.each(function(){return b(this).find(g).length?(a.pagination=b(this).find(g),!1):void 0})),console.log(this.pagination),this.pagination.length&&!this.pagination.find("> *").length){for(console.log(this.pagination),c=this.pagination.hasClass("pagination"),e=0,d="";e<this.pages+1;)e===this.pages&&(d+="<span>...</span>"),d+=c?"<li><a href='#' data-datatable-page='"+e+"'>"+(e+1)+"</a></li>":"<a href='#' data-datatable-page='"+e+"'>"+(e+1)+"</a>",0===e&&(d+="<span>...</span>"),e++;return this.pagination.append(d),setTimeout(function(a){return function(){return a.bindPaginationEvents()}}(this),0)}},buildComplexPagination:function(){var a,c;return a=0,this.currentPage<3?(this.pagination.find("> span").first().hide(),this.pagination.find("> span").last().css("display","inline-block"),c=[0,1,2,3,this.pages]):this.currentPage>this.pages-3?(this.pagination.find("> span").first().css("display","inline-block"),this.pagination.find("> span").last().hide(),c=[0,this.pages-3,this.pages-2,this.pages-1,this.pages]):(this.pagination.find("> span").css("display","inline-block"),c=[0,this.currentPage-1,this.currentPage,this.currentPage+1,this.pages]),this.pagination.find("> [data-datatable-page]").each(function(){var a;return a=b(this).data("datatable-page"),c.indexOf(a)<0?b(this).hide():b(this).show()})},updatePaginationVisibility:function(){var a,b,c;for(a=0,this.pagination.find("[data-datatable-page]").hide(),c=[];a<this.pages+1;)b=this.pagination.find("[data-datatable-page='"+a+"']"),b.css("display","inline-block"),c.push(a++);return c},bindPaginationEvents:function(){return this.pagination.on("click","[data-datatable-page]",function(a){return function(c){var d;return c.preventDefault(),d=b(c.target).data("datatable-page"),a.trigger("showpage.datatable.clique",[d])}}(this))},updatePagination:function(){return this.options.paginationWrapper&&this.elements.pagination&&this.elements.pagination.length?(this.buildPagination(),this.pages>6?this.buildComplexPagination():this.updatePaginationVisibility(),this.pagination&&this.pagination.length?this.pagination.hasClass("pagination")?(this.pagination.find("[data-datatable-page]").parent().removeClass("active"),this.pagination.find("[data-datatable-page='"+this.currentPage+"']").parent().addClass("active")):(this.pagination.find("[data-datatable-page]").removeClass("active"),this.pagination.find("[data-datatable-page='"+this.currentPage+"']").addClass("active")):void 0):void 0},bindEvents:function(){return this.elements.thead.on("click",".datatable-sort",function(a){return function(c){var d;return c.preventDefault(),d=b(c.target).closest("th").index(),a.sortEventHandler(d)}}(this))},sortEventHandler:function(a){return this.options.sortColumn===a?("desc"===this.options.sortOrder&&(this.options.sortColumn=-1),this.options.sortOrder="asc"===this.options.sortOrder?"desc":"asc"):(this.options.sortColumn=a,this.options.sortOrder="asc"),this.trigger("sort.datatable.clique",[this.options.sortColumn,this.options.sortOrder])},bindListeners:function(){return this.on("showpage.datatable.clique",function(a){return function(b,c){return a.showPage(c)}}(this)),this.on("didshowpage.datatable.clique",function(a){return function(b,c,d,e,f){return a.didShowPage(c,d,e,f)}}(this)),this.on("next.datatable.clique",function(a){return function(){return a.showNextPage()}}(this)),this.on("previous.datatable.clique",function(a){return function(){return a.showPreviousPage()}}(this)),this.on("sort.datatable.clique",function(a){return function(b,c,d){return a.sortByColumn(c,d)}}(this))},didShowPage:function(a,b,c,d){return this.elements.paginationWrapper&&!this.elements.paginationWrapper.find("> *").length?(console.log(this.elements),this.buildPagination()):void 0},addObserver:function(){var b;return b=this.elements.tbody,a.domObserve(b[0],function(a){return function(){return a.observerCallback()}}(this))},removeObserver:function(){var a,b;return b=this.elements.tbody,a=b.data("observer"),a.disconnect()},observerCallback:function(){var a;return this.observerIsTriggered=!0,a=this.elements.tbody,this.hasRows=!!a.find("> tr").length,this.cacheData(),this.options.sortColumn>-1&&setTimeout(function(a){return function(){return a.trigger("sort.datatable.clique",[a.options.sortColumn,a.options.sortOrder])}}(this),0),this.options.paginate&&this.options.sortColumn<0&&setTimeout(function(a){return function(){return a.trigger("showpage.datatable.clique",[a.currentPage])}}(this),0),setTimeout(function(a){return function(){a.observerIsTriggered=!1}}(this),0)},cacheData:function(){var c,d,e,f,g,h;return h=this.elements.tbody,this.hasRows?(e=[],d=this.columns,g=a.utils.isNumber,f=a.utils.isDate,h.find("> tr").each(function(){var a;return a=[],b(this).find("> *").each(function(c){var e,h,i,j;return i=b(this).text(),h=b(this).html(),j=g(i)?parseFloat(i):f(i)?new Date(i):i,e={index:c,key:d[c].title,value:j,text:i,html:h},a.push(e)}),e.push(a)}),c=this,setTimeout(function(){return c.setDataProperties(e)},0)):void 0},sortByColumn:function(a,b){var c,d,e,f,g,h,i;if(null==b&&(b="asc"),a=parseInt(a,10),0>a)return void this.printOriginalData();for(b=b.toLowerCase(),"asc"!==b&&"desc"!==b&&(b="asc"),d=this.getDataForColumn(a),e=function(a,c){if("asc"===b){if(a.value<c.value)return-1;if(a.value>c.value)return 1}else{if(a.value>c.value)return-1;if(a.value<c.value)return 1}return 0},g=d.sort(e),f=[],h=0,i=g.length;i>h;h++)c=g[h],f.push(this.data[c.index]);return this.setDataProperties(f),this.addSortClass(a,b),this.trigger("showpage.datatable.clique",[this.currentPage])},printOriginalData:function(){return this.setDataProperties(this.originalData),this.removeSortClass(),this.trigger("showpage.datatable.clique",[this.currentPage])},addSortClass:function(a,b){return this.removeSortClass(),this.elements.th.eq(a).find(".datatable-sort").addClass("datatable-sort-active datatable-sort-"+b)},removeSortClass:function(){return this.elements.th.find(".datatable-sort").removeClass("datatable-sort-active datatable-sort-asc datatable-sort-desc")},showNextPage:function(){var a;return a=this.currentPage+1,a=a>this.pages?this.pages:a,this.showPage(a)},showPreviousPage:function(){var a;return a=this.currentPage-1,a=0>a?0:a,this.showPage(a)},showPage:function(a){var b,c,d,e,f,g,h,i;if(this.hasRows&&this.dataLength){for(this.removeObserver(),this.removeAllRows(),f=this.options.perPage*a,d=f+this.options.perPage,d=d>this.dataLength?this.dataLength:d,c=this.getDataForRange(f,d),h=0,i=c.length;i>h;h++)e=c[h],this.addRow(e);return b=this,g=this.element,setTimeout(function(){return b.currentPage=a,b.disablePrevious=0===f?!0:!1,b.disableNext=b.currentPage===b.pages?!0:!1,b.updatePagination(),g.trigger("didshowpage.datatable.clique",[b.currentPage,0===f?1:f,d,b.dataLength]),b.addObserver()},0)}},addRow:function(a){var c,d,e,f,g,h;for(f=b("<tr />"),g=0,h=a.length;h>g;g++)c=a[g],d=c.text,e=b("<td>"+d+"</td>"),f.append(e);return this.elements.tbody.append(f)},removeAllRows:function(){var a;return a=this.elements.tbody,a.find("> *").remove()},getDataForRange:function(a,b){var c,d;for(c=a,d=[];b>c;)d.push(this.data[c]),c++;return d},getDataForColumn:function(a){var b,c,d,e,f;if(!this.data||!this.dataLength)return[];d=[],f=this.data;for(c in f)e=f[c],b=e[a],d.push({index:parseInt(c,10),value:b.value});return d},columnInfo:function(a){return this.data&&this.dataLength?{title:this.data[0][a].key,index:a}:{}},searchString:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;if(null==b&&(b=[]),a=a.trim(),!a||!a.length)return void this.printOriginalData();if(!b.length)for(n=this.columns,j=0,l=n.length;l>j;j++)d=n[j],this.options.hidden.indexOf(d.index)<0&&b.push(d.index);for(g=[],f=0;f<this.originalData.length;){for(h=this.originalData[f],i="",k=0,m=b.length;m>k;k++)e=b[k],c=h[e],i+=" "+c.html;i=i.trim(),i.indexOf(a)>-1&&g.push(h),f++}return this.setDataProperties(g),this.showPage(0)},destroy:function(){return this.restoreOriginalRows(),this.removePagination(),this.unbindEvents(),this.removeStyle(),this.removeData(),setTimeout(function(a){return function(){return a.trigger("destroy.datatable.clique")}}(this),0)},restoreOriginalRows:function(){var a,b,c,d,e;for(this.removeAllRows(),d=this.originalData,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.addRow(a));return e},removePagination:function(){return this.pagination.find("> *").remove()},unbindEvents:function(){return this.find(".datatable-sort").off("click"),this.previousButton.off("click"),this.nextButton.off("click")},removeStyle:function(){return this.elements.th.removeAttr("style"),this.elements.tbody.find("td").removeAttr("style")},removeData:function(){return this.element.removeData("clique.data.datatable")}})});