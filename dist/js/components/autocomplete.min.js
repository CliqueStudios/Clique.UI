/*!
 *  CliqueUI - v1.0.4 - 2015-10-14
 *  http://ui.cliquestudios.com
 *  Copyright (c) 2015 Clique Studios;
 */

!function(a){if("function"==typeof define&&define.amd&&define("clique-autocomplete",["clique"],function(){return a(Clique)}),!window.Clique)throw new Error("Clique.autocomplete requires Clique.core");window.Clique&&a(Clique)}(function(a){var b,c;return b=a.$,c=null,a.component("autocomplete",{defaults:{minLength:3,param:"search",method:"post",delay:300,loadingClass:"loading",flipDropdown:!1,skipClass:"skip",hoverClass:"active",source:null,renderer:null,template:'<ul class="nav nav-autocomplete autocomplete-results">{{~items}}<li data-value="{{$item.value}}"><a>{{$item.value}}</a></li>{{/items}}</ul>'},visible:!1,value:null,selected:null,boot:function(){return a.$html.on("focus.autocomplete.clique","[data-autocomplete]",function(b){var c,d;c=a.$(this),c.data("clique.data.autocomplete")||(d=a.autocomplete(c,a.utils.options(c.attr("data-autocomplete"))))}),a.$html.on("click.autocomplete.clique",function(a){return c&&a.target!==c.input[0]?c.hide():void 0})},init:function(){var b,c,d;b=this,c=!1,d=a.utils.debounce(function(a){return c?void(c=!1):b.handle()},this.options.delay),this.dropdown=this.find(".dropdown"),this.template=this.find('script[type="text/autocomplete"]').html(),this.template=a.utils.template(this.template||this.options.template),this.input=this.find("input:first").attr("autocomplete","off"),this.dropdown.length||(this.dropdown=a.$('<div class="dropdown"></div>').appendTo(this.element)),this.options.flipDropdown&&this.dropdown.addClass("dropdown-flip"),this.dropdown.attr("aria-expanded","false"),this.input.on({keydown:function(a){if(a&&a.which&&!a.shiftKey)switch(a.which){case 13:if(c=!0,b.selected)return a.preventDefault(),b.select();break;case 38:return a.preventDefault(),b.pick("prev",!0);case 40:return a.preventDefault(),b.pick("next",!0);case 27:case 9:return b.hide()}},keyup:d}),this.dropdown.on("click",".autocomplete-results > *",function(){return b.select()}),this.dropdown.on("mouseover",".autocomplete-results > *",function(){return b.pick(a.$(this))}),this.triggercomplete=d},handle:function(){var a,b;return a=this,b=this.value,this.value=this.input.val(),this.value.length<this.options.minLength?this.hide():(this.value!==b&&a.request(),this)},pick:function(b,c){var d,e,f,g,h,i,j;return d=this,g=a.$(this.dropdown.find(".autocomplete-results").children(":not(."+this.options.skipClass+")")),i=!1,"string"==typeof b||b.hasClass(this.options.skipClass)?("next"===b||"prev"===b)&&(this.selected?(f=g.index(this.selected),i="next"===b?g.eq(f+1<g.length?f+1:0):g.eq(0>f-1?g.length-1:f-1)):i=g["next"===b?"first":"last"](),i=a.$(i)):i=b,i&&i.length&&(this.selected=i,g.removeClass(this.options.hoverClass),this.selected.addClass(this.options.hoverClass),c&&(j=i.position().top,h=d.dropdown.scrollTop(),e=d.dropdown.height(),j>e||0>j))?d.dropdown.scrollTop(h+j):void 0},select:function(){var a;if(this.selected)return a=this.selected.data(),this.trigger("select.clique.autocomplete",[a,this]),a.value&&this.input.val(a.value).trigger("change"),this.hide()},show:function(){return this.visible?void 0:(this.visible=!0,this.element.addClass("open"),c=this,this.dropdown.attr("aria-expanded","true"),this)},hide:function(){return this.visible?(this.visible=!1,this.element.removeClass("open"),c===this&&(c=!1),this.dropdown.attr("aria-expanded","false"),this):void 0},request:function(){var b,c,d,e,f;if(b=this,e=function(a){return a&&b.render(a),b.element.removeClass(b.options.loadingClass)},this.element.addClass(this.options.loadingClass),!this.options.source)return this.element.removeClass(b.options.loadingClass);switch(f=this.options.source,typeof this.options.source){case"function":return this.options.source.apply(this,[e]);case"object":if(f.length)return c=[],f.forEach(function(a){return a.value&&-1!==a.value.toLowerCase().indexOf(b.value.toLowerCase())?c.push(a):void 0}),e(c);break;case"string":return d={},d[this.options.param]=this.value,a.$.ajax({url:this.options.source,data:d,type:this.options.method,dataType:"json"}).done(function(a){e(a||[])});default:return e(null)}},render:function(a){return this.dropdown.empty(),this.selected=!1,this.options.renderer?this.options.renderer.apply(this,[a]):a&&a.length&&(this.dropdown.append(this.template({items:a})),this.show(),this.trigger("show.clique.autocomplete")),this}}),a.autocomplete});