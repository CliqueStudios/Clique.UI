/*!
 *  CliqueUI - v1.0.4 - 2015-10-14
 *  http://ui.cliquestudios.com
 *  Copyright (c) 2015 Clique Studios;
 */

!function(a){if("function"==typeof define&&define.amd&&define("clique-upload",["clique"],function(){return a(Clique)}),!window.Clique)throw new Error("Clique.upload requires Clique.core");window.Clique&&a(Clique)}(function(a){var b,c,d;return b=a.$,d=function(b,e){var f,g,h,i,j,k,l,m;if(j=function(b,c){var d,e,f,g,h,i,j,k;if(e=new FormData,h=new XMLHttpRequest,c.before(c,b)!==!1){for(i=0,j=b.length;j>i;i++)d=b[i],e.append(c.params,d);k=c.params;for(f in k)g=k[f],e.append(f,g);return h.upload.addEventListener("progress",function(a){var b;return b=a.loaded/a.total*100,c.progress(b,a)},!1),h.addEventListener("loadstart",function(a){return c.loadstart(a)},!1),h.addEventListener("load",function(a){return c.load(a)},!1),h.addEventListener("loadend",function(a){return c.loadend(a)},!1),h.addEventListener("error",function(a){return c.error(a)},!1),h.addEventListener("abort",function(a){return c.abort(a)},!1),h.open(c.method,c.action,!0),h.onreadystatechange=function(){var b,d;if(c.readystatechange(h),4===h.readyState){if(d=h.responseText,"json"===c.type)try{d=a.$.parseJSON(d)}catch(e){b=e,d=!1}return c.complete(d,h)}},c.beforeSend(h),h.send(e)}},!a.support.ajaxupload)return this;if(e=a.$.extend({},d.defaults,e),b.length){if("*.*"!==e.allow)for(l=0,m=b.length;m>l;l++)i=b[l],c(e.allow,i.name)||("string"==typeof e.notallowed?alert(e.notallowed):e.notallowed(i,e));return g=e.complete,e.single?(h=b.length,k=0,f=!0,e.beforeAll(b),e.complete=function(a,c){return k+=1,g(a,c),e.filelimit&&k>=e.filelimit&&(f=!1),f&&h>k?j([b[k]],e):e.allcomplete(a,c)},j([b[0]],e)):(e.complete=function(a,b){return g(a,b),e.allcomplete(a,b)},j(b,e))}},c=function(a,b){var c;return c="^"+a.replace(/\//g,"\\/").replace(/\*\*/g,"(\\/[^\\/]+)*").replace(/\*/g,"[^\\/]+").replace(/((?!\\))\?/g,"$1.")+"$",c="^"+c+"$",null!==b.match(new RegExp(c,"i"))},a.component("uploadSelect",{init:function(){var a;return a=this,this.on("change",function(){var b;d(a.element[0].files,a.options),b=a.element.clone(!0).data("uploadSelect",a),a.element.replaceWith(b),a.element=b})}}),a.component("uploadDrop",{defaults:{dragoverClass:"dragover"},init:function(){var a,b;return a=this,b=!1,this.on("drop",function(b){return b.dataTransfer&&b.dataTransfer.files?(b.stopPropagation(),b.preventDefault(),a.element.removeClass(a.options.dragoverClass),a.element.trigger("dropped.clique.upload",[b.dataTransfer.files]),d(b.dataTransfer.files,a.options)):void 0}).on("dragenter",function(a){return a.stopPropagation(),a.preventDefault()}).on("dragover",function(c){c.stopPropagation(),c.preventDefault(),b||(a.element.addClass(a.options.dragoverClass),b=!0)}).on("dragleave",function(c){c.stopPropagation(),c.preventDefault(),a.element.removeClass(a.options.dragoverClass),b=!1})}}),a.support.ajaxupload=function(){var a,b,c;return b=function(){var a;return a=document.createElement("INPUT"),a.type="file","files"in a},a=function(){var a;return a=new XMLHttpRequest,!!(a&&"upload"in a&&"onprogress"in a.upload)},c=function(){return!!window.FormData},b()&&a()&&c()}(),a.support.ajaxupload&&a.$.event.props.push("dataTransfer"),d.defaults={action:"",single:!0,method:"POST",param:"files[]",params:{},allow:"*.*",type:"text",filelimit:!1,before:function(a){},beforeSend:function(a){},beforeAll:function(){},loadstart:function(){},load:function(){},loadend:function(){},error:function(){},abort:function(){},progress:function(){},complete:function(){},allcomplete:function(){},readystatechange:function(){},notallowed:function(a,b){return alert("Only the following file types are allowed : "+b.allow)}},a.utils.xhrupload=d,d});